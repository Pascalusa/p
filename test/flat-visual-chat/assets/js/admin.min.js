
var vcht_checkTimer;var vcht_lastRep=false;var vcht_currentLogID=0;var vcht_currentDomElement="";var vcht_isChatting=false;jQuery(document).ready(function(){if(jQuery("#chat").length>0){$.extend($.tablesorter.themes.bootstrap,{table:"table table-bordered",caption:"caption",header:"bootstrap-header",footerRow:"",footerCells:"",icons:"",sortNone:"bootstrap-icon-unsorted",sortAsc:"icon-chevron-up glyphicon glyphicon-chevron-up",sortDesc:"icon-chevron-down glyphicon glyphicon-chevron-down",active:"",hover:"",filterRow:"",even:"",odd:""});jQuery("#vcht_operatorname").html(vcht_operator);jQuery("#vcht_consolePanelContent").hide();jQuery("#vcht_onlineCB").change(function(){if(jQuery(this).is(":checked")){vcht_operatorConnect()}else{vcht_operatorDisconnect()}})}});function vcht_operatorConnect(){jQuery("#vcht_initiatePanel").slideDown();jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operatorConnect",operatorID:vcht_operatorID,success:function(){vcht_recoverChats()}}})}function vcht_operatorDisconnect(){jQuery("#vcht_initiatePanel").slideUp();clearTimeout(vcht_checkTimer);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operatorDisconnect",operatorID:vcht_operatorID,success:function(){}}})}function vcht_checkUsers(){if(jQuery("#usersList li[data-logid]").length==0){jQuery("#vcht_btnMinimize").fadeOut(200);if(jQuery("#usersList li").length==1){jQuery("#usersList").append('<li class="vcht_nobody">There are no chat currently</li>')}vcht_minifyChatPanel()}else{jQuery("#vcht_btnMinimize").fadeIn(200);jQuery("#vcht_btnMinimize").delay(250).css("display","block");jQuery("#usersList .vcht_nobody").remove()}if(jQuery('#usersList li[data-logid="'+vcht_currentLogID+'"]').length==0){vcht_currentLogID=0;vcht_minifyChatPanel()}}function vcht_recoverChats(){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_recoverChats",operatorID:vcht_operatorID},success:function(b){var a=jQuery.parseJSON(b);jQuery.each(a,function(){var c=this;if(c.id){var d=jQuery('<li class="chat" data-logid="'+c.id+'" data-chatrequest="0" data-userid="'+c.userID+'" data-username="'+c.username+'"></li>');d.append('<a href="javascript:">'+c.username+'<span class="navbar-unread">1</span></a>');jQuery("#usersList").append(d);d.children("a").click(vcht_clickUserTab);vcht_createChatPanel(c);jQuery.each(c.messages,function(){var e=this;if(e.isOperator==1){vcht_say(e,c.id,e.avatarOperator)}else{if(c.avatarImg){vcht_userSay(e,c.id,e.url,c.avatarImg)}else{vcht_userSay(e,c.id,e.url)}}})}});vcht_isChatting=true;vcht_checkOperatorChat();vcht_checkUsers()}})}function vcht_toggleChatPanel(){if(jQuery("#vcht_consolePanelContent").is(".opened")){vcht_minifyChatPanel()}else{vcht_openChatPanel()}}function vcht_minifyChatPanel(){if(jQuery("#vcht_consolePanelContent").is(".opened")){jQuery("#vcht_btnMinimize span").removeClass("glyphicon-chevron-down");jQuery("#vcht_btnMinimize span").addClass("glyphicon-chevron-up");jQuery("#vcht_consolePanelContent").removeClass("opened");jQuery("#vcht_consolePanelContent").hide("bind")}}function vcht_openChatPanel(){if(!jQuery("#vcht_consolePanelContent").is(".opened")){jQuery("#vcht_consolePanelContent > div[data-logid]").each(function(){if(jQuery(this).css("display")!="none"){vcht_currentLogID=parseInt(jQuery(this).data("logid"))}});jQuery("#vcht_btnMinimize span").removeClass("glyphicon-chevron-up");jQuery("#vcht_btnMinimize span").addClass("glyphicon-chevron-down");jQuery("#vcht_consolePanelContent").addClass("opened");jQuery("#vcht_consolePanelContent").show("bind")}}function vcht_getLogs(a){vcht_minifyChatPanel();vcht_currentLogID=0;jQuery("#vcht_consoleFrame").prop("src","admin.php?page=vcht-logsList&userID="+a)}function vcht_exitChat(a){jQuery("#vcht_consoleFrame").contents().find(".vcht_selectedDom").removeClass("vcht_selectedDom");jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_closeChat",logID:a},success:function(){jQuery("#usersList li[data-logid="+a+"]").fadeOut(250);jQuery("#usersList li[data-logid="+a+"]").delay(500).remove();jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").fadeOut(250);jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").delay(500).remove();vcht_currentLogID=0;vcht_checkUsers()}})}function vcht_createChatPanel(e){var d="";if(e.avatarImg&&e.avatarImg!=""){d='style="background-image: none;"'}else{e.avatarImg=""}var g="";if(e.userID>0){g='<p><a href="javascript:" onclick="vcht_getLogs('+e.userID+');"  class="btn btn-primary"><span class="fui-search"></span>See user logs</a></p>'}var b=jQuery('<div data-logid="'+e.id+'" data-userid="'+e.userid+'"></div>');b.append('<div class="col-md-2 palette palette-wet-asphalt" id="vcht_userInfos"><div class="vcht_avatarImg" style="background-image: url(include/files/'+vcht_operatorAvatar+');"></div><p><strong class="vcht_username">'+e.username+"</strong></p>"+g+'<p class="vcht_onlineOperatorsNb">Online operators: <strong>1</strong></p></div>');jQuery("#vcht_consolePanelContent").append(b);var a=jQuery('<div class="vcht_chatContent"></div>');b.append(a);var f=jQuery('<div class="vcht_chatHistory"></div>');a.append(f);a.append('<div class="vcht_chatInfos palette palette-primary"><p><span class="glyphicon glyphicon-time"></span><br/><strong class="vcht_timePast">00:00:00</strong></p><p><div class="dropdown"><div class="btn-group select select-block open"><button class="btn dropdown-toggle clearfix btn-primary" data-toggle="dropdown"><span class="filter-option pull-left">Transfer chat</span>&nbsp;<span class="caret"></span></button><span class="dropdown-arrow dropdown-arrow-inverse"></span><ul data-logid="'+e.id+'" class="vcht_transferSelect dropdown-menu dropdown-inverse" role="menu" style="max-height: 616px; overflow-y: auto; min-height: 108px;"></ul></div></div></p><p><a href="javascript:" onclick="vcht_exitChat('+e.id+');" class="btn btn-danger"><span class="fui-cross"></span>Stop chat</a></p></div>');var c=jQuery('<div class="vcht_chatWrite palette palette-clouds container-fluid"></div>');a.append(c);if(e.operatorID==0){b.find(".vcht_chatInfos").hide();c.append('<p class="vcht_chatWrite_newChat"><a href="javascript:" onclick="vcht_acceptChat('+e.id+');" class="btn btn-primary">Accept this chat</a></p>')}else{b.find(".vcht_chatInfos").fadeIn(200);vcht_initChatWrite(e.id)}}function vcht_checkOperatorChat(){if(vcht_isChatting){vcht_checkTimer=setTimeout(function(){var a="";jQuery("#usersList li[data-logid]").each(function(){var b=this;a+=jQuery(this).data("logid")+","});if(a.length>0){a=a.substr(0,a.length-1)}jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_check_operator_chat",operatorID:vcht_operatorID,currentChats:a},success:function(d){var c=jQuery.parseJSON(d);vcht_lastRep=c;var b=new Array();if(c.chatRequests.length>0){jQuery.each(c.chatRequests,function(){req=this;b.push((req.id));if(jQuery("#usersList li[data-logid="+req.id+"]").length==0){var e=jQuery('<li class="palette palette-turquoise reqChat" data-logid="'+req.id+'" data-chatrequest="1" data-userid="'+req.userID+'" data-username="'+req.username+'"></li>');e.append('<a href="javascript:">'+req.username+"</a>");jQuery("#usersList").append(e);e.children("a").click(vcht_clickUserTab);if(jQuery("#vcht_audioMsg").data("enable")!="false"){jQuery("#vcht_audioMsg").get(0).play()}if(req.id!=vcht_currentLogID&&jQuery("#usersList li[data-logid="+req.id+"] a span").length==0){jQuery("#usersList li[data-logid="+req.id+"] a").append('<span class="navbar-unread">1</span>')}}})}jQuery('#usersList li[data-logid][data-chatrequest="1"]').not(".vcht_accepted").each(function(){var e=this;var f=false;jQuery.each(c.chatRequests,function(){req=this;if(parseInt(req.id)==parseInt(jQuery(e).data("logid"))){f=true}});if(!f){jQuery(this).remove()}});jQuery.each(c.chats,function(){var g=this;var f=Math.floor(g.timePast/(60*60));var i=g.timePast%(60*60);var h=Math.floor(i/60);var e=i%60;var j=Math.ceil(e);if(jQuery('#vcht_consolePanelContent > div[data-logid="'+g.id+'"]').length==0){vcht_createChatPanel(g)}if(jQuery('#usersList li[data-logid="'+g.id+'"]').length==0){var k=jQuery('<li class="palette palette-turquoise reqChat" data-logid="'+g.id+'" data-chatrequest="0"  data-vchtid="'+g.vcht_id+'" data-userid="'+g.userID+'" data-username="'+g.username+'"></li>');k.append('<a href="javascript:">'+g.username+"</a>");jQuery("#usersList").append(k);k.children("a").click(vcht_clickUserTab);k.children("a").trigger("click");k.delay(3000).removeClass("palette-turquoise")}else{if(g.vcht_id>0&&jQuery('#customersList li[data-vchtid="'+g.vcht_id+'"]').length>0){jQuery('#usersList li[data-logid="'+g.id+'"] a').html(jQuery('#customersList li[data-vchtid="'+g.vcht_id+'"] a').html())}}jQuery("#vcht_consolePanelContent > div[data-logid="+g.id+"] .vcht_timePast").html(f.toString().replace(/^(\d)$/,"0$1")+":"+h.toString().replace(/^(\d)$/,"0$1")+":"+j.toString().replace(/^(\d)$/,"0$1"));jQuery.each(g.messages,function(){var l=this;vcht_userSay(l,g.id,l.url);if(vcht_currentLogID==g.id&&l.url!=jQuery("#vcht_consoleFrame").prop("src")){jQuery("#vcht_consoleFrame").prop("src",l.url)}if(g.id!=vcht_currentLogID){jQuery("#usersList li[data-logid="+g.id+"] a > span.navbar-unread").fadeIn(100);if(jQuery("#vcht_audioMsg").data("enable")!="false"){jQuery("#vcht_audioMsg").get(0).play()}}})});jQuery.each(c.chatsClosed,function(){var e=this;if(jQuery("#usersList li[data-logid="+e+"]").length>0){if(jQuery("#usersList li[data-logid="+e+"]").is(".palette-turquoise")){vcht_exitChat(e)}else{jQuery("#usersList li[data-logid="+e+"]").addClass("palette palette-concrete");jQuery("#vcht_consolePanelContent > div[data-logid="+e+"] .vcht_chatHistory").append('<div class="userAction palette palette-clouds"><div class="avatarImg bubble_photo"></div> User disconnects.</div>');jQuery("#vcht_consolePanelContent > div[data-logid="+e+"] .vcht_chatHistory .userAction:last-child").fadeIn(250);jQuery("#vcht_consolePanelContent > div[data-logid="+e+"] .vcht_chatWrite").fadeOut(200)}}});jQuery.each(c.transfers,function(){var e=this;vcht_createChatPanel(e);jQuery("#vcht_consolePanelContent > div[data-logid="+e.id+"] .vcht_chatInfos").fadeIn(250);jQuery.each(e.messages,function(){var g=this;if(g.isOperator=="1"){vcht_say(g,e.id)}else{vcht_userSay(g,e.id,g.url)}});jQuery("#vcht_consolePanelContent > div[data-logid="+e.id+"] .vcht_chatHistory").append('<div class="userAction palette palette-clouds"><div class="avatarImg bubble_photo"></div> This discussion was transferred to you</div>');jQuery("#vcht_consolePanelContent > div[data-logid="+e.id+"] .vcht_chatHistory .userAction:last-child").fadeIn(250);var f=jQuery('<li class="palette palette-turquoise reqChat" data-logid="'+e.id+'" data-chatrequest="0" data-userid="'+e.userID+'" data-username="'+e.username+'"></li>');f.append('<a href="javascript:">'+e.username+"</a>");jQuery("#usersList").append(f);f.children("a").click(vcht_clickUserTab);jQuery("#vcht_consolePanelContent > div[data-logid="+e.id+"]").find(".vcht_chatContent").scrollTop(jQuery("#vcht_consolePanelContent > div[data-logid="+e.id+"]").find(".vcht_chatContent")[0].scrollHeight);if(jQuery("#vcht_audioMsg").data("enable")!="false"){jQuery("#vcht_audioMsg").get(0).play()}});if(c.operators.length>1){jQuery("ul.vcht_transferSelect").html('<li rel="0" class=""><a tabindex="-1" href="#" class="active"><span class="pull-left">Choose operator</span></a></li>')}else{jQuery("ul.vcht_transferSelect").html('<li rel="0" class=""><a tabindex="-1" href="#" class="active"><span class="pull-left">No operators </<span></a></li>')}jQuery.each(c.operators,function(f){var e=this;if(e.id!=vcht_operatorID){var g=jQuery('<li data-userid="'+e.id+'" rel="'+(f+1)+'" class=""><a tabindex="-1" href="#" class="active"><span class="pull-left">'+e.username+"</span></a></li>");jQuery("ul.vcht_transferSelect").append(g);jQuery("ul.vcht_transferSelect > li[data-userid != 0]").click(function(){var h=$(this).attr("data-userid");if(typeof h!==typeof undefined&&h!==false){var j=jQuery(this).parent("ul").data("logid");var i=jQuery(this).data("userid");jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_transferChat",logID:j,operatorID:i},success:function(){jQuery("#usersList li[data-logid="+j+"]").fadeOut(250);jQuery("#vcht_consolePanelContent > div[data-logid="+j+"]").fadeOut(250);setTimeout(function(){jQuery("#usersList li[data-logid="+j+"]").remove();jQuery("#vcht_consolePanelContent > div[data-logid="+j+"]").remove()},500)}})}})}});jQuery(".vcht_onlineOperatorsNb strong").html(c.operators.length);jQuery("#customersList label > span").html(c.users.length);jQuery.each(c.users,function(f){var g="";var e="";if(this.logExist){g="palette palette-silver"}else{e='onclick="vcht_initiateChat('+this.id+')"'}if(jQuery('#customersList .dropdown-menu li[data-vchtid="'+this.id+'"]').length>0){jQuery('#customersList .dropdown-menu li[data-vchtid="'+this.id+'"]').attr("class",g);jQuery('#customersList .dropdown-menu li[data-vchtid="'+this.id+'"] a').html(this.username)}else{jQuery("#customersList .dropdown-menu").append('<li  data-vchtid="'+this.id+'"><a href="#" '+e+' class="'+g+'">'+this.username+"</a></li>")}});jQuery("#customersList .dropdown-menu li[data-vchtid]").each(function(){var e=false;var f=jQuery(this);jQuery.each(c.users,function(g){if(this.id==f.attr("data-vchtid")){e=true}});if(!e){f.remove()}});vcht_checkUsers();vcht_checkOperatorChat()}})},4000)}}function vcht_getChat(a,d,c){var b=false;if(vcht_lastRep){if(c){jQuery.each(vcht_lastRep.chatRequests,function(){var e=this;if(a>0&&e.userID==a){b=e}else{if(a==0&&e.username==d){b=e}}})}else{jQuery.each(vcht_lastRep.chats,function(){var e=this;if(a>0&&e.userID==a){b=e}else{if(a==0&&e.username==d){b=e}}})}}return b}function vcht_clickUserTab(){jQuery(".vcht_admin_panel").fadeOut(100);jQuery(this).find("span.navbar-unread").fadeOut(100);if(jQuery(this).is("palette-turquoise")&&jQuery(this).data("chatrequest")=="0"){jQuery(this).removeClass("palette-turquoise")}vcht_loadChatPanel(jQuery(this).parent().data("logid"));vcht_currentLogID=jQuery(this).parent().data("logid");vcht_openChatPanel()}function vcht_isIframe(){try{return window.self!==window.top}catch(a){return true}}function vcht_declineChat(a){jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").hide();jQuery("#usersList li[data-logid="+a+"]").hide()}function vcht_acceptChat(a){jQuery("#usersList li[data-logid="+a+"]").addClass("vcht_accepted");jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").fadeOut(250);jQuery("#vcht_loader").delay(300).fadeIn(100);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_acceptChat",logID:a,operatorID:vcht_operatorID},success:function(b){if(b=="1"){jQuery("#usersList li[data-logid="+a+"]").removeClass("palette");jQuery("#usersList li[data-logid="+a+"]").removeClass("palette-turquoise").data("chatrequest","0");vcht_initChatWrite(a);jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatHistory").html("");jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").delay(1500).fadeIn(250);jQuery("#vcht_loader").delay(1400).fadeOut(100);jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").delay(300).find(".vcht_chatInfos").fadeIn(200)}}})}function vcht_initChatWrite(a){jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatWrite").html('<div class="col-md-7"><div class="form-group"><textarea  data-logid="'+a+'" data-url="" data-domelement="" class="form-control" rows="3" placeholder="Write your message here"></textarea></div></div>');jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatWrite").append('<div class="col-md-3"><p>Element selected : <strong class="vcht_hasElementSelected">No</strong></p><p><a href="javascript:" class="btn btn-primary" onclick="vcht_startSelectDomElement();"><span class="fui-eye"></span> Select an element</a></p></div>');jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatWrite").append('<div class="col-md-2"><a href="javascript:" onclick="vcht_sendMessage('+a+')" class="btn btn-lg btn-primary btn-block vcht_sendBtn"><span class="fui-chat"></span></a></div>');jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatWrite textarea").keypress(function(b){if(b.which==13&&!b.shiftKey){b.preventDefault();vcht_sendMessage(jQuery(this).data("logid"))}})}function vcht_startSelectDomElement(){vcht_minifyChatPanel();jQuery("#vcht_consolePanel").delay(500).fadeOut(250);jQuery("#vcht_infosPanel > .container > .col-md-12").html('<p>Navigate to the desired page and click on "Select an element" button.</p>');jQuery("#vcht_infosPanel > .container > .col-md-12").append('<p><a href="javascript:" class="btn btn-primary" onclick="vcht_targetDomElement();">Select an element</a><a href="javascript:" class="btn btn-warning" onclick="vcht_stopSelectDomElement();">Cancel</a></p>');jQuery("#vcht_infosPanel").delay(850).fadeIn(250)}function vcht_targetDomElement(){jQuery("#vcht_infosPanel > .container > .col-md-12").html("<p>Click on the desired item</p>");jQuery("#vcht_consoleFrame").get(0).contentWindow.vcht_startSelection()}function vcht_stopSelectDomElement(){jQuery("#vcht_infosPanel").fadeOut(250);jQuery("#vcht_consolePanel").delay(300).fadeIn(250);setTimeout(function(){vcht_openChatPanel()},600)}function vcht_selectDomElement(a){vcht_currentDomElement=a;jQuery("#vcht_infosPanel > .container > .col-md-12").html("<p>Do you want to show this item to the user?</p>");jQuery("#vcht_infosPanel > .container > .col-md-12").append('<p><a href="javascript:" class="btn btn-primary" onclick="vcht_confirmDomElement();">Yes</a><a href="javascript:" class="btn btn-warning" onclick="vcht_targetDomElement();">No</a></p>')}function vcht_confirmDomElement(a){var b=vcht_getPath(vcht_currentDomElement);jQuery("#vcht_consolePanelContent > div[data-logid="+vcht_currentLogID+"] .vcht_chatWrite .vcht_hasElementSelected").html("Yes");jQuery("#vcht_consolePanelContent > div[data-logid="+vcht_currentLogID+"] .vcht_chatWrite textarea").data("domelement",b);jQuery("#vcht_consolePanelContent > div[data-logid="+vcht_currentLogID+"] .vcht_chatWrite textarea").data("url",jQuery("#vcht_consoleFrame").get(0).contentWindow.document.location.href);vcht_stopSelectDomElement()}function vcht_getPath(a){var b="";if(jQuery(a).length>0&&typeof(jQuery(a).prop("tagName"))!="undefined"){if(!jQuery(a).attr("id")||jQuery(a).attr("id").indexOf("yui")>-1){b=">"+jQuery(a).prop("tagName")+":nth-child("+(jQuery(a).index()+1)+")"+b;b=vcht_getPath(jQuery(a).parent())+b}else{b+="#"+jQuery(a).attr("id")}}return b}function vcht_sendMessage(g){jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").parent().removeClass("has-error");var a=jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").val();if(a==""){jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").parent().addClass("has-error")}else{var i=new Date();var j=i.getDate();var d=i.getMonth()+1;var e=i.getFullYear();var f=i.getHours();var c=i.getMinutes();var k=i.getSeconds();if(j<10){j="0"+j}if(d<10){d="0"+d}if(f>12){f=f-12}if(f<10){f="0"+f}if(c<10){c="0"+c}if(k<10){k="0"+k}var b=e+"-"+d+"-"+j+" "+f+":"+c+":"+k;a=a.replace(/\n/g,"<br/>");jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operatorSay",logID:g,operatorID:vcht_operatorID,msg:a,operatorname:vcht_operator,domElement:jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").data("domelement"),url:jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").data("url")},success:function(h){vcht_say({content:a,date:h},g);jQuery("#vcht_consolePanelContent > div[data-logid="+g+"] .vcht_chatWrite .vcht_hasElementSelected").html("No");jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").val("");jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").data("domelement","");jQuery("#vcht_consolePanelContent > div[data-logid="+g+"]").find(".vcht_chatWrite textarea").data("url","")}})}}function vcht_userSay(f,d,e,c){var b=jQuery('<div class="bubble_left palette palette-clouds" data-url="'+e+'"></div>');b.append('<div class="bubble_arrow"></div>');b.append(f.content);var g=jQuery("#vcht_consolePanelContent > div[data-logid="+d+"] .vcht_username").html();var a=f.date.substr(f.date.indexOf(" ")+1);b.append('<div class="bubble_meta">'+a+" - "+g+"</div>");b.append('<div class="avatarImg bubble_photo"></div>');jQuery("#vcht_consolePanelContent > div[data-logid="+d+"]").find(".vcht_chatHistory").append(b);b.fadeIn(250);jQuery("#vcht_consolePanelContent > div[data-logid="+d+"]").find(".vcht_chatContent").scrollTop(jQuery("#vcht_consolePanelContent > div[data-logid="+d+"]").find(".vcht_chatContent")[0].scrollHeight)}function vcht_say(e,c,d){var b=jQuery('<div class="bubble_right palette palette-turquoise"></div>');b.append(e.content);var f=jQuery("#vcht_operatorname").html();if(e.username&&e.username!=""){f=e.username}var a=e.date.substr(e.date.indexOf(" ")+1);b.append('<div class="bubble_meta">'+a+" - "+f+"</div>");b.append('<div class="bubble_arrow"></div>');if(d){b.append('<div class="avatarImg bubble_photo" style="background-image: url(include/files/'+d+');"></div>')}else{b.append('<div class="avatarImg bubble_photo" style="background-image: url(include/files/'+vcht_operatorAvatar+');"></div>')}jQuery("#vcht_consolePanelContent > div[data-logid="+c+"]").find(".vcht_chatHistory").append(b);b.fadeIn(250);jQuery("#vcht_consolePanelContent > div[data-logid="+c+"]").find(".vcht_chatContent").scrollTop(jQuery("#vcht_consolePanelContent > div[data-logid="+c+"]").find(".vcht_chatContent")[0].scrollHeight)}function vcht_loadChatPanel(a){if(jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").length>0){jQuery("#vcht_consolePanelContent > div").fadeOut(250);jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").delay(300).fadeIn(250);setTimeout(function(){jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").find(".vcht_chatContent").scrollTop(jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").find(".vcht_chatContent")[0].scrollHeight)},800);var b="";b=jQuery("#vcht_consolePanelContent > div[data-logid="+a+"] .vcht_chatHistory .bubble_left:last-child").data("url");jQuery("#vcht_consoleFrame").prop("src",b)}else{jQuery("#vcht_loader").fadeIn(100);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_getLogChat",logID:a},success:function(e){var c=jQuery.parseJSON(e);jQuery("#vcht_consolePanelContent > div").fadeOut(500);vcht_createChatPanel(c);var d="";jQuery.each(c.messages,function(){var h=this;if(h.isOperator==1){var g=jQuery('<div class="bubble_right palette palette-turquoise"></div>');g.append(h.content);g.append('<div class="bubble_arrow"></div>')}else{var g=jQuery('<div class="bubble_left palette palette-clouds" data-url="'+h.url+'"></div>');g.append('<div class="bubble_arrow"></div>');g.append(h.content);d=h.url}g.append('<div class="avatarImg bubble_photo"></div>');var f=jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]");f.find(".vcht_chatHistory").append(g);g.fadeIn(250);f.find(".vcht_chatContent").delay(500).scrollTop(f.find(".vcht_chatContent")[0].scrollHeight)});jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").delay(1000).fadeIn(500);jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").find(".vcht_chatContent").delay(1500).scrollTop(jQuery("#vcht_consolePanelContent > div[data-logid="+a+"]").find(".vcht_chatContent")[0].scrollHeight);jQuery("#vcht_consoleFrame").prop("src",d);jQuery("#vcht_loader").fadeOut(100)}})}}function vcht_homeOpen(){jQuery(".vcht_admin_panel").fadeOut(500);jQuery("#vcht_consoleFrame").fadeIn(250)}function vcht_settingsOpen(){jQuery(".vcht_admin_panel").fadeOut(500);jQuery("#vcht_consoleFrame").fadeOut(250);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_settings_view"},success:function(a){jQuery("#vcht_admin_settings").html(a);jQuery("#vcht_admin_settings").fadeIn(250);jQuery(".colorpick").each(function(){var b=jQuery(this);jQuery(this).colpick({color:b.val().substr(1,7),onChange:function(c,g,e,f,d){jQuery(f).val("#"+g)}})})}})}function vcht_settingsSave(a){var b=new FormData(jQuery("#form_settings")[0]);jQuery.ajax({url:"include/serverAjax.php",type:"post",xhr:function(){var c=$.ajaxSettings.xhr();return c},success:function(c){if(c=="updated"){document.location.href=document.location.href}if(c=="no"){jQuery("#set_purchaseCode").parent().addClass("has-error")}jQuery("#vcht_admin_settings .vcht_response").html('<div class="alert alert-success" role="alert"><p>Settings <strong>saved</strong></p></div>');jQuery("#vcht_admin_settings .vcht_response").fadeIn(250);document.location.href=document.location.href},data:b,cache:false,contentType:false,processData:false})}function vcht_logsOpen(a){jQuery(".vcht_admin_panel").fadeOut(500);jQuery("#vcht_consoleFrame").fadeOut(250);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_logs_view",filter:a},success:function(b){jQuery("#vcht_admin_logs").html(b);jQuery(".tablesorter").tablesorter({theme:"bootstrap",widthFixed:true,headerTemplate:"{content} {icon}",sortList:[[0,1],[1,1]],widgets:["uitheme","filter","zebra"],widgetOptions:{zebra:["even","odd"],filter_reset:".reset"},initialized:function(c){jQuery(".tablesorter-filter").addClass("form-control").prop("placeholder","Filter")}});jQuery("#vcht_admin_logs").fadeIn(250)}})}function vcht_logRemove(a){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_log_remove",logID:a},success:function(b){jQuery("#vcht_admin_logs .vcht_response").html('<div class="alert alert-success" role="alert"><p>Log <strong>deleted</strong></p></div>');jQuery("#vcht_admin_logs .vcht_response").fadeIn(250);vcht_logsOpen()}})}function vcht_logOpen(a){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_log_view",logID:a},success:function(b){jQuery("#vcht_admin_logs").html(b);jQuery("#vcht_admin_logs").fadeIn(250)}})}function vcht_operatorsOpen(){jQuery(".vcht_admin_panel").fadeOut(500);jQuery("#vcht_consoleFrame").fadeOut(250);jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operators_view"},success:function(a){jQuery("#vcht_admin_operators").html(a);jQuery("#vcht_admin_operators").fadeIn(250)}})}function vcht_operatorRemove(a){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operator_remove",operatorID:a},success:function(b){jQuery("#vcht_admin_logs .vcht_response").html('<div class="alert alert-success" role="alert"><p>Operator <strong>deleted</strong></p></div>');jQuery("#vcht_admin_logs .vcht_response").fadeIn(250);vcht_operatorsOpen()}})}function vcht_operatorOpen(a){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_operator_view",operatorID:a},success:function(b){jQuery("#vcht_admin_operators").html(b);jQuery("#vcht_admin_operators").fadeIn(250)}})}function vcht_operatorSave(a){var b=0;if(a){b=a}var c=new FormData(jQuery("#form_operator")[0]);jQuery.ajax({url:"include/serverAjax.php",type:"post",xhr:function(){var d=$.ajaxSettings.xhr();return d},success:function(d){jQuery("#vcht_admin_operators .vcht_response").html('<div class="alert alert-success" role="alert"><p>Operator <strong>saved</strong></p></div>');jQuery("#vcht_admin_operators .vcht_response").fadeIn(250)},data:c,cache:false,contentType:false,processData:false})}function vcht_initiateChat(a){if(jQuery('#usersList [data-vchtid="'+a+'"]').length==0){jQuery.ajax({url:"include/serverAjax.php",type:"post",data:{action:"vcht_initiateChat",vcht_id:a,operatorID:vcht_operatorID,operatorname:vcht_operator},success:function(b){}})}};